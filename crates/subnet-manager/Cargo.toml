[package]
name = "subnet-manager"
version = "0.1.0"
edition = "2021"
description = "WireGuard Subnet Manager for heterogeneous node registration"
authors = ["HPC-AI Platform"]
license = "MIT"

[features]
default = []
postgres = ["sqlx/postgres"]
hpc-channels = ["dep:hpc-channels"]
# Real network probing with quality tracking (RTT, jitter, packet loss)
quality-probing = []
full = ["hpc-channels", "quality-probing"]

[dependencies]
# Core
tokio = { version = "1", features = ["full"] }
async-trait = "0.1"
futures = "0.3"

# Networking
ipnet = { version = "2.9", features = ["serde"] }

# Concurrency
dashmap = "5.5"
parking_lot = "0.12"

# Serialization
serde = { version = "1", features = ["derive"] }
serde_json = "1"

# Database
sqlx = { version = "0.7", features = ["runtime-tokio", "uuid", "chrono", "json"], optional = true }

# Types
uuid = { version = "1", features = ["v4", "serde"] }
chrono = { version = "0.4", features = ["serde"] }

# Error handling
thiserror = "1"
anyhow = "1"

# Logging
tracing = "0.1"

# Regex for policy matching
regex = "1"

# Cryptography
rand = "0.8"

# API
axum = { version = "0.7", features = ["json"] }
tower = { version = "0.4", features = ["util"] }
tower-http = { version = "0.5", features = ["cors", "trace"] }
http = "1.0"

# gRPC (optional)
tonic = { version = "0.11", optional = true }

# HPC Platform Integration (optional)
hpc-channels = { path = "../../../01-hpc-channels", optional = true }

# NAT Traversal & Connectivity Probing (optional)
# Note: nebula-traverse has WireGuard deps that conflict with warp-crypto
# Quality tracking is embedded directly to avoid dependency conflicts
# nebula-traverse = { path = "../../../10-nebula/crates/nebula-traverse", optional = true }

[dev-dependencies]
tokio-test = "0.4"
pretty_assertions = "1"
http-body-util = "0.1"
criterion = { version = "0.5", features = ["html_reports"] }

[[bench]]
name = "allocator_bench"
harness = false

[[bench]]
name = "policy_bench"
harness = false

[[bench]]
name = "event_bench"
harness = false

[[bench]]
name = "migration_bench"
harness = false
